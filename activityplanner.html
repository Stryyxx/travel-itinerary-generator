<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Activity Planner</title>
		<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
		<style>
			@import url("https://fonts.googleapis.com/css2?family=Playwrite+NG+Modern:wght@100..400&display=swap");
			body {
				font-family: "Inter", sans-serif;
			}
			.header-bg {
				background-image: linear-gradient(
						to right,
						rgba(0, 0, 0, 0.6) 0%,
						rgba(0, 0, 0, 0.6) 16.67%,
						rgba(0, 0, 0, 0.5) 16.67%,
						rgba(0, 0, 0, 0.5) 33.34%,
						rgba(0, 0, 0, 0.4) 33.34%,
						rgba(0, 0, 0, 0.4) 50.01%,
						rgba(0, 0, 0, 0.3) 50.01%,
						rgba(0, 0, 0, 0.3) 66.68%,
						rgba(0, 0, 0, 0.2) 66.68%,
						rgba(0, 0, 0, 0.2) 83.35%,
						rgba(255, 255, 255, 0) 83.35%,
						rgba(255, 255, 255, 0) 100%
					),
					url("images/headerimage.jpg");
				background-attachment: fixed;
				background-size: cover;
				background-position: center;
			}
			.parallax {
				background-image: linear-gradient(to right, rgba(0, 0, 0, 0.2) 0%, rgba(0, 0, 0, 0.2) 100%),
					url("images/plannerimage.jpg");
				height: 100vh;
				background-attachment: fixed;
				background-size: cover;
				background-position: center;
			}
			.parallax-content {
				position: relative;
				z-index: 1;
				background-image: linear-gradient(to right, rgba(0, 0, 0, 0.4) 0%, rgba(0, 0, 0, 0.4) 100%),
					url("images/routeimage.jpg");
				background-attachment: fixed;
				background-size: cover;
				background-position: center;
			}
			html {
				scroll-behavior: smooth;
			}
			.marquee-container {
				width: 75%;
				font-family: Playwrite NG Modern;
				height: max-content;
			}
			.header-text {
				max-width: 50%;
			}
		</style>
	</head>
	<body class="bg-gray-100 font-sans leading-normal tracking-normal min-h-screen">
		<div class="absolute top-0 w-full flex justify-center py-4">
			<ul class="inline-block list-none text-center">
				<li class="inline-block mx-4"><a href="index.html" class="text-2xl font-bold text-white">Home</a></li>
				<li class="inline-block mx-4">
					<a href="activityplanner.html" class="text-2xl font-bold text-white">Activity Planner</a>
				</li>
			</ul>
		</div>

		<header class="header-bg bg-cover bg-center h-screen">
			<div class="flex items-center justify-center h-full bg-gray-900 bg-opacity-50">
				<div class="text-center text-white px-4">
					<h1 class="text-5xl font-bold mb-4">Plan Your Activities</h1>
					<p class="text-2xl mb-8">Upload your route and plan activities at each destination</p>
					<a
						href="#planner"
						class="bg-blue-500 px-8 py-4 text-xl rounded-full hover:bg-blue-700 transition duration-700 shadow-2xl shadow-white"
						>Get Started</a
					>
				</div>
			</div>
		</header>

		<section class="parallax">
			<div class="flex items-center justify-center h-full">
				<div class="text-center text-white px-4 marquee-container">
					<marquee class="text-5xl font-bold mb-4"
						>Welcome to the activity planner. If you don't have a route yet, please make one in the route
						planner.</marquee
					>
				</div>
			</div>
		</section>

		<section id="planner" class="bg-gray-100 pt-16 parallax-content">
			<div class="container mx-auto">
				<h2 class="text-4xl font-bold text-center mb-12 text-gray-100">Activity Planner</h2>
				<div class="flex flex-col items-start mx-4">
					<input type="file" id="import-route" class="hidden" />
					<label
						for="import-route"
						class="bg-yellow-500 text-white px-8 py-3 rounded-full hover:bg-yellow-700 transition cursor-pointer mx-2 transition duration-700 shadow-2xl shadow-white"
						>Import Route</label
					>
					<div id="activities-container" class="w-full mt-8"></div>
					<button
						id="export-activities"
						class="bg-green-500 text-white px-8 py-3 rounded-full hover:bg-green-700 transition cursor-pointer mx-2 transition duration-700 shadow-2xl shadow-white mt-4"
					>
						Export Activities
					</button>
				</div>
			</div>
			<footer class="text-center text-gray-100 pt-6 pb-6">&copy; Max Horvath 2024. All rights reserved.</footer>
		</section>
		<!-- Include Flatpickr Library -->
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" />
		<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

		<script>
			document.addEventListener("DOMContentLoaded", () => {
				const activitiesContainer = document.getElementById("activities-container");
				let route = [];

				document.getElementById("import-route").addEventListener("change", (event) => {
					const file = event.target.files[0];
					if (file) {
						const reader = new FileReader();
						reader.onload = (e) => {
							route = JSON.parse(e.target.result);
							displayActivities();
						};
						reader.readAsText(file);
					}
				});

				document.getElementById("export-activities").addEventListener("click", () => {
					const activities = route.map((location, index) => {
						const activityElements = document.querySelectorAll(`#activities-${index} .activity`);
						const dateElements = document.querySelectorAll(`#activities-${index} .date-picker`);
						const activityList = Array.from(activityElements).map((el, i) => {
							return `${el.value} (Date and Time: ${dateElements[i].value})`;
						});
						return { ...location, activities: activityList };
					});

					let textFileContent = activities
						.map((activity) => {
							return `${activity.address}, ${activity.country}:\n${activity.activities.join("\n")}`;
						})
						.join("\n\n");

					const blob = new Blob([textFileContent], { type: "text/plain" });
					const url = URL.createObjectURL(blob);
					const a = document.createElement("a");
					a.href = url;
					a.download = "activities.txt";
					document.body.appendChild(a);
					a.click();
					document.body.removeChild(a);
				});

				const displayActivities = () => {
					activitiesContainer.innerHTML = "";
					route.forEach((location, index) => {
						const locationDiv = document.createElement("div");
						locationDiv.className = "bg-white rounded-lg shadow-md p-6 mb-4 w-full";
						locationDiv.innerHTML = `
                <h3 class="text-2xl font-bold mb-4">${location.address}, ${location.country}</h3>
                <div id="activities-${index}" class="activities-list">
                    <input type="text" class="activity w-full p-2 mb-2 border border-gray-300 rounded-lg" placeholder="Activity">
                    <input type="text" class="date-picker w-full p-2 mb-2 border border-gray-300 rounded-lg" placeholder="Select date and time">
                </div>
                <button class="add-activity bg-blue-500 text-white px-4 py-2 rounded-full hover:bg-blue-700 transition" data-index="${index}">Add Activity</button>
            `;
						activitiesContainer.appendChild(locationDiv);

						// Initialize date picker
						flatpickr(`.date-picker`, {
							enableTime: true,
							dateFormat: "Y-m-d H:i",
						});
					});

					document.querySelectorAll(".add-activity").forEach((button) => {
						button.addEventListener("click", (event) => {
							const index = event.target.getAttribute("data-index");
							const activitiesList = document.getElementById(`activities-${index}`);
							const newActivityInput = document.createElement("input");
							newActivityInput.type = "text";
							newActivityInput.className = "activity w-full p-2 mb-2 border border-gray-300 rounded-lg";
							newActivityInput.placeholder = "Activity";
							const newDatePicker = document.createElement("input");
							newDatePicker.type = "text";
							newDatePicker.className = "date-picker w-full p-2 mb-2 border border-gray-300 rounded-lg";
							newDatePicker.placeholder = "Select date and time";
							activitiesList.appendChild(newActivityInput);
							activitiesList.appendChild(newDatePicker);

							// Reinitialize date picker
							flatpickr(newDatePicker, {
								enableTime: true,
								dateFormat: "Y-m-d H:i",
							});
						});
					});
				};
			});
		</script>
	</body>
</html>
